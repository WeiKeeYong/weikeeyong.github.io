<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yong Wei Kee - Technology Leader with nearly 30 years of experience">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- n8n chat widget stylesheet -->
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    
    <!-- Custom CSS variables for chat styling -->
    <style>
    :root {
        /* Align colors with site theme */
        --chat--color-primary: #2563eb; /* same as --primary-color */
        --chat--color-primary-shade-50: #1e40af; /* same as --secondary-color */
        --chat--color-primary-shade-100: #1e3a8a; /* deeper indigo */
        
        --chat--color-secondary: #3b82f6; /* same as --accent-color */
        --chat--color-secondary-shade-50: #2563eb; /* use primary as a shade */
        
        --chat--color-white: #ffffff;
        --chat--color-light: #f7f9fc; /* same as --light-bg */
        --chat--color-light-shade-50: #e2e8f0; /* subtle blue-gray for shading */
        --chat--color-light-shade-100: #cbd5e1;
        --chat--color-medium: #d2d4d9;
        --chat--color-dark: #1e293b; /* dark slate for contrast */
        --chat--color-disabled: #64748b; /* cool muted blue */
        --chat--color-typing: #475569; /* readable medium gray-blue */
    
        /* Spacing & size tweaks */
        --chat--spacing: 1rem;
        --chat--border-radius: 12px; /* match --border-radius */
        --chat--transition-duration: 0.2s;
    
        --chat--window--width: 400px;
        --chat--window--height: 600px;
    
        /* Header style */
        --chat--header-height: auto;
        --chat--header--padding: var(--chat--spacing);
        --chat--header--background: var(--chat--color-primary);
        --chat--header--color: var(--chat--color-white);
        --chat--header--border-top: none;
        --chat--header--border-bottom: none;
    
        /* Font sizes */
        --chat--heading--font-size: 1.5em;
        --chat--subtitle--font-size: 1em;
        --chat--subtitle--line-height: 1.8;
    
        /* Text input */
        --chat--textarea--height: 50px;
    
        /* Message bubble styling */
        --chat--message--font-size: 0.85rem;
        --chat--message--padding: var(--chat--spacing);
        --chat--message--border-radius: var(--chat--border-radius);
        --chat--message-line-height: 1.6;
        --chat--message--bot--background: var(--chat--color-light);
        --chat--message--bot--color: var(--chat--color-dark);
        --chat--message--bot--border: none;
        --chat--message--user--background: var(--chat--color-primary);
        --chat--message--user--color: var(--chat--color-white);
        --chat--message--user--border: none;
        --chat--message--pre--background: rgba(37, 99, 235, 0.1); /* light indigo */
    
        /* Toggle button */
        --chat--toggle--background: var(--chat--color-primary);
        --chat--toggle--hover--background: var(--chat--color-primary-shade-50);
        --chat--toggle--active--background: var(--chat--color-primary-shade-100);
        --chat--toggle--color: var(--chat--color-white);
        --chat--toggle--size: 64px;
    }

    /* Chat status indicator */
    .chat-status {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #ef4444;
        color: white;
        padding: 10px 15px;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        display: none;
    }

    .chat-status.offline {
        display: block;
    }

    .chat-status.online {
        background: #22c55e;
        display: block;
    }

    /* Hide chat when offline */
    #n8n-chat.chat-offline {
        display: none !important;
    }
    </style>
    
    <title>Yong Wei Kee | Tech Leader | Innovator | AI Enthusiast</title>
</head>
<body>
    <header>
        <div class="container">
            <h1>Yong Wei Kee</h1>
            <p class="tagline">Technology Leader | Innovator | AI Enthusiast</p>
        </div>
    </header>
    <main class="container">
        <section class="hero">
            <div class="hero-content">
                <h2>Transforming Technology with 30 Years of Leadership</h2>
                <p>Driving innovation through strategic technology solutions and team empowerment</p>
            </div>
        </section>
        
        <div class="card-grid">
            <section class="card professional-summary">
                <div class="card-icon">üë®‚Äçüíª</div>
                <h2>About Me</h2>
                <p>Technology leader with nearly 30 years of experience leading interdisciplinary teams and delivering high-impact technology initiatives. Expert in stakeholder management, Agile methodologies, and emerging technologies.</p>
                <p><strong>Offering:</strong> ChatBot or AI Chat creation and implementation</p>
                <p><strong>Office:</strong> +60 3-8011 8504</p>
            </section>
            
            <section class="card achievements">
                <div class="card-icon">üèÜ</div>
                <h2>Achievements</h2>
                <ul>
                    <li>Implemented CRM solutions for enhanced customer engagement.</li>
                    <li>Led GenAI adoption to improve workflow efficiency.</li>
                    <li>Drove Agile transformation, increasing team productivity by 20-30%.</li>
                    <li>Integrated advanced payment solutions for security and efficiency.</li>
                    <li>Replaced manual workflows with Jira & Confluence.</li>
                </ul>
            </section>
            
            <section class="card interests">
                <div class="card-icon">‚ù§Ô∏è</div>
                <h2>Interests</h2>
                <ul>
                    <li>IoT with Raspberry Pi & Arduino</li>
                    <li>Machine Learning & Computer Vision</li>
                    <li>AI Testing & Automation</li>
                    <li>Cooking & Gardening</li>
                </ul>
            </section>
            
            <section class="card online-profile">
                <div class="card-icon">üåê</div>
                <h2>Online Profile</h2>
                <p>Connect with me on <a href="https://www.linkedin.com/in/weikee/" target="_blank" class="linkedin-btn">LinkedIn</a>.</p>
            </section>
        </div>
    </main>
    
    <!-- Chat container - this is where the chat will appear -->
    <div id="n8n-chat"></div>
    
    <!-- Chat status indicator -->
    <div id="chat-status" class="chat-status">
        Chat is currently offline
    </div>
    
    <footer class="container">
        <p>¬© <span id="current-year">2023</span> Yong Wei Kee. All rights reserved.</p>
    </footer>
    
    <!-- n8n chat widget script -->
    <script type="module">
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

        const webhookUrl = 'https://n8n.yongdomain.com/webhook/0b27a903-1b69-455a-8daf-fcfe74656a16/chat';
        const chatContainer = document.getElementById('n8n-chat');
        const statusIndicator = document.getElementById('chat-status');

        let chatInstance = null;
        let isChecking = false;

        // Function to check webhook status by attempting a simple test message
        async function checkWebhookStatus() {
            if (isChecking) return false;
            isChecking = true;
            
            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'ping',
                        chatInput: 'test-connection',
                        sessionId: 'health-check'
                    })
                });
                
                isChecking = false;
                // If we get any response (even error), the server is accessible
                return response.status < 500;
            } catch (error) {
                console.log('Webhook unreachable:', error.message);
                isChecking = false;
                return false;
            }
        }

        // Function to initialize chat
        function initializeChat() {
            if (chatInstance) return; // Prevent multiple instances
            
            try {
                chatInstance = createChat({
                    webhookUrl: webhookUrl,
                    target: '#n8n-chat',
                    mode: 'window',
                    chatInputKey: 'chatInput',
                    chatSessionKey: 'sessionId',
                    metadata: {},
                    showWelcomeScreen: false,
                    defaultLanguage: 'en',
                    initialMessages: [
                        'üëã Hello',
                        'I am YWK Bot. How can I assist you today?'
                    ],
                    i18n: {
                        en: {
                            title: 'YWK Bot',
                            subtitle: "Start a chat. We're here to help you 24/7.",
                            footer: '',
                            getStarted: 'New Conversation',
                            inputPlaceholder: 'Type your question..',
                        },
                    },
                });
                return true;
            } catch (error) {
                console.error('Chat initialization failed:', error);
                chatInstance = null;
                return false;
            }
        }

        // Function to destroy chat instance
        function destroyChat() {
            if (chatInstance) {
                try {
                    // Clear the chat container
                    chatContainer.innerHTML = '';
                    chatInstance = null;
                } catch (error) {
                    console.log('Error destroying chat:', error);
                }
            }
        }

        // Function to update chat status
        function updateChatStatus(isOnline) {
            if (isOnline) {
                chatContainer.classList.remove('chat-offline');
                statusIndicator.className = 'chat-status online';
                statusIndicator.textContent = 'Chat is online';
                // Hide status after 3 seconds if online
                setTimeout(() => {
                    if (statusIndicator.className.includes('online')) {
                        statusIndicator.style.display = 'none';
                    }
                }, 3000);
            } else {
                chatContainer.classList.add('chat-offline');
                statusIndicator.className = 'chat-status offline';
                statusIndicator.textContent = 'Chat is currently offline';
                statusIndicator.style.display = 'block';
            }
        }

        // Main initialization - check webhook FIRST
        async function initializePage() {
            // Start with offline status
            updateChatStatus(false);
            
            // Check webhook availability first
            console.log('Checking webhook status...');
            const isWebhookWorking = await checkWebhookStatus();
            
            if (isWebhookWorking) {
                console.log('Webhook is online, initializing chat...');
                const chatInitialized = initializeChat();
                if (chatInitialized) {
                    updateChatStatus(true);
                } else {
                    console.log('Chat initialization failed');
                    updateChatStatus(false);
                }
            } else {
                console.log('Webhook is offline, chat disabled');
                updateChatStatus(false);
            }
        }

        // Monitor chat status periodically
        setInterval(async () => {
            const isOnline = await checkWebhookStatus();
            const isChatOffline = chatContainer.classList.contains('chat-offline');
            
            if (isOnline && isChatOffline && !chatInstance) {
                // Webhook came back online, reinitialize chat
                const initialized = initializeChat();
                if (initialized) {
                    updateChatStatus(true);
                }
            } else if (!isOnline && !isChatOffline && chatInstance) {
                // Webhook went offline, destroy chat
                destroyChat();
                updateChatStatus(false);
            }
        }, 30000);

        // Initialize on page load
        initializePage();
    </script>
    
    <script>
        document.getElementById('current-year').textContent = new Date().getFullYear();
    </script>
</body>
</html>
